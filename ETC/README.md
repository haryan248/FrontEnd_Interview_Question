## NGINX 쓴 이유?

아파치 서버의 경우 요청 1개당 프로세스 1개를 생성

→ 메모리 부족으로 이어짐

→ CPU 코어의 부하 UP (context switching)

수많은 동시 서버를 운영하기엔 부적합

NGINX 사용해 아파치를 극복

수많은 동시 커넥션을 엔진엑스가 유지

-   동적 파일 요청에만 아파치에게 요청
-   정적파일은 바로 처리

### Nginx 처리 방법

**이벤트 기반 구조**

master process

worker process(실제로 일하는 프로세스)

→ listen socket을 배정받음

커넥션 생성, 커넥션 제거, 새로운 요청을 처리하는것을 모두 이벤트라고 부름

OS 커널이 큐형태로 worker process에게 제공

-   worker process가 쉬지 않고 일함
-   큐에서 들어온 이벤트들 중에 오래 걸릴것 같은 이벤트는 쓰레드풀로 위임
-   CPU의 코어 개수만큼 생성 (context switching이 적게 일어남)

단점

작동하고 있던 worker process가 멈추면 처리하던 이벤트들이 작동하지 않게됨

→ 개발자가 직접 모듈을 만들기 어려움

장점

-   동시 커넥션 양 최소 10배 증가
-   동일한 커넥션 수일 때 속도 2배 향상
-   프로세스를 적게 만드는 구조는 동적설정 변경이 가능해짐
    -   개발자가 설정을 변경해 적용하면 master process가 해당 worker process를 따로 생성하면서 기존의 worker process는 커넥션을 연결하지 않도록 해줌
    -   nginx뒤에 새로운 서버를 설정해야할 때 동시 커넥션을 유지한채 새로운 프로세스에 커넥션 할당이 가능해짐
-   동시 커넥션이 많아져도 메모리 사용률이 낮고 일정하게 나옴

**NGINX의 사용이 많아진 이유**

-   스마트폰이 나오면서 동시 커넥션이 많이 필요해짐
-   TCP 연결이 동시에 여러개가 요청이 들어오게 됌
    -   대규모 사이트를 운영하고있는 큰회사에 적용하기 좋음

아파치 서버의 경우 안정성과 확장성이 좋음

엔진엑스는 C10K 동시 커넥션 문제에 있어 해결이 좋음

SSL 터미네이션을 사용할 수 있다.

-   client와는 https 통신, 서버와는 http 통신하는 구조
-   서버가 복호화 과정을 담당하지 않도록 할 수 있다.

HSTS, CORS 처리, TCP/UDP 커넥션 부하 분산, HTTP/2 지원
